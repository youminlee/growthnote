<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>GrowthNote</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #fff;
      margin: 0;
      padding: 40px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .description {
      font-size: 14px;
      color: #555;
      margin-bottom: 30px;
    }

    .upload-box {
      border: 2px dashed #ccc;
      padding: 60px 20px;
      text-align: center;
      border-radius: 10px;
      margin-bottom: 30px;
    }

    textarea {
      width: 100%;
      height: 250px;
      margin-top: 20px;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-bottom: 30px;
    }

    .button-group button {
      background-color: #f1f3f5;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
    }

    .progress {
      font-size: 13px;
      color: #666;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“˜ GrowthNote</h1>
    <p class="description">
      ì†ŒìŠ¤ë¥¼ ì¶”ê°€í•˜ë©´ ì¤‘ìš”í•œ ì •ë³´ë¥¼ ìš”ì•½í•˜ì—¬ êµ¬ê¸€ ë‹¥ìŠ¤ë¡œ ì œê³µí•©ë‹ˆë‹¤.
    </p>

    <div class="upload-box">
      <h2>ğŸ“¤ ì†ŒìŠ¤ ì—…ë¡œë“œ</h2>
      <input type="file" id="fileInput" />
      <p>ì—…ë¡œë“œí•  <a href="#">íŒŒì¼ì„ ì„ íƒ</a>í•˜ê±°ë‚˜ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ì„¸ìš”.</p>
      <p style="font-size: 12px; color: #aaa;">ì§€ì›ë˜ëŠ” íŒŒì¼ í˜•ì‹: PDF, txt, mp3, png, jpg ë“±</p>
    </div>

    <div class="button-group">
      <button>ğŸ“„ Google Docs</button>
      <button>ğŸ“‹ ë³µì‚¬í•œ í…ìŠ¤íŠ¸</button>
    </div>

    <h3>ğŸ“„ ì¶”ì¶œëœ í…ìŠ¤íŠ¸</h3>
    <textarea id="output" placeholder="ì—¬ê¸°ì— íŒŒì¼ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤."></textarea>
    <button id="summarizeBtn" style="margin-top: 20px; padding: 10px 16px;">âœ¨ ìš”ì•½ ë° ì•¡ì…˜ ë„ì¶œ</button>
    <div class="progress">ì†ŒìŠ¤ í•œë„: 1/300</div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const output = document.getElementById('output');

    fileInput.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const fileType = file.type;

      if (fileType === "text/plain") {
        const reader = new FileReader();
        reader.onload = function (e) {
          output.value = e.target.result;
        };
        reader.readAsText(file);
      } else if (fileType === "application/pdf") {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let textContent = '';

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const text = await page.getTextContent();
          const pageText = text.items.map(item => item.str).join(' ');
          textContent += pageText + '\n\n';
        }

        output.value = textContent;
      } else {
        alert('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. (.txt ë˜ëŠ” .pdfë§Œ ê°€ëŠ¥)');
      }
    });
    
  </script>
  <script>
    const summarizeBtn = document.getElementById('summarizeBtn');
    summarizeBtn.addEventListener('click', async () => {
      const inputText = document.getElementById("output").value;
      if (!inputText || inputText.trim().length === 0) {
        alert('ë¨¼ì € í…ìŠ¤íŠ¸ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        return;
      }
  
      summarizeBtn.innerText = "ë¬¸ì„œ ìƒì„± ì¤‘...";
  
      // âœ… CORS ìš°íšŒ í”„ë¡ì‹œ URL ì‚¬ìš©
      const scriptUrl = "https://script.google.com/macros/s/AKfycbwlKbnvw3muQ6h7DUKf8mZqY0ua4fh0dcvgksM-yF9JAMO3MZ7mU7xd9bVJm5OWozyj/exec";
      const corsProxyUrl = "https://corsproxy.io/?" + encodeURIComponent(scriptUrl);
  
      try {
        const response = await fetch(corsProxyUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ content: inputText })
        });
  
        const docUrl = await response.text();
        window.open(docUrl, "_blank");
      } catch (err) {
        alert("ë¬¸ì„œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        console.error(err);
      } finally {
        summarizeBtn.innerText = "âœ¨ ìš”ì•½ ë° ì•¡ì…˜ ë„ì¶œ";
      }
    });
  </script>
    
</body>
</html>
